import {Cipher} from "../ballot/encryptedBallot";
import {BigNumberHelper} from "../helper/bigNumberHelper";
import bigInt from "big-integer";
import {ProofOfDecryption} from "../cryptography/proofOfDecryption";

describe("ProofOfDecryption test", () => {
    const p: bigInt.BigInteger = BigNumberHelper.fromHexString("ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff");
    const g: bigInt.BigInteger = BigNumberHelper.fromHexString("2");

    it("should classify proof as valid", () => {
        // arrange
        const publicKey: bigInt.BigInteger = BigNumberHelper.fromHexString("d8a3e5eb179a35ec58fe63e6ec4d8790735815281082c5c0945ffcc8060a10e52acceefb8568c78fbe143683c81a2d815397bdcfa8ee1acf73b121a7ba2dfa8917301b03fe21a57489db3cafb360215c879e86b2e1d34e65518cc7de93efc30cab7898f62d2a96d44c5e7ceb759017b3552933d33d5005ab6c22701d5ed138c106dbe4bf5c1bedf57e0ed88680c1d3aeb29edd9856ed38bda3ea5612d9dcac3e17c165b35fca3c17b947b4040b9fb24346be9d04042d554c33e0fbdd5fc07f645a542786f8e65a12ef7deab80ce680332feaa496532151c22ac756dddef45a41b7df858115ec0d2f9ee359ff7b296d667ce32018c52a01bd0fef13e55f581827");

        const cipher: Cipher = {
            c: BigNumberHelper.fromHexString("a5b3ab609e17b34daca50edfff7ed2ecf1f8d67312f0cc7e12070c9ffabf1cb4c59d1d5c7e266b8e320dd4c16ade53821fb1f4ddeea27cb157a95cdb92fe074af3bcea094e6d978f37b39ffb23f70aab030d6c9fccfd2247d1877ae104c11a5a9c888176ad3fc340cd67eb9fd2341e567cec3699a9dd44881551c0c02c17f36864430cdd2abf20044a3de3f90b0f9921e0d54b457a6b7cac9635830d1a3ed6b4e4721b9080a88c0d941dddf2f63350569686b8f026ba4a3389e83ff774cf99d36022578dc7590b146a18227215728c6ce6e7b189e9f1e91a1356108c8a6fa622177680007a7da6fc2e03f6f7f349ce6ae5b78c5c2d2535bb0161eeb5e51f82e7"),
            d: BigNumberHelper.fromHexString("c9fdac59c83da0aaa09ee7e8751fdc794eaf12a87f96493b3d9e51dacf469f06a42aab0c8e47ae64b1e226b31bbadfb376dec28626703f22e1a2a8614cfec466ad6109050a2312d94029ada026e0764bf0824188423428539287855e7db6c91cccb23e7299b688ec79a894b7fe03f62d0a851e1e073ef040cbd53948d5d00c02b0a2e18c9fdabd70e6b35f0f96ac085149914e34c1e522812e99ac2c5730a80b1db2fb645d4a799ca06e2cbf76e908fbaa3e3a26e5eb89574518c003cf022951a53b6ab982cb3b698ee82c87a57268d3eb726aed35c2d9a9bc8c64c0627be0ac98f1f202d6fec777e98af4a73a92f60f71d93cab3b732f198582de6b10b36751")
        }

        const proof: ProofOfDecryption = new ProofOfDecryption(
            "dd26068235e6962e10f8f5d7ea71c19d1466b5284131be298fb907a9e6508921ba35c0bf0a11ceba4eff95efecc0c37efe2d9bcf3fb23fa74a7bdd28a7f59cd64781a3e5b8947388bf9c44b4c129d253a8bcdb73348fd6b438da21e7b5c3597adb6d03a295e3dd05a1edb7ee425a8fa09963e3a3005ec5058bd6abf06cb3273bb02c78ab1a38141f184f542809b9553968fc0f0423a4124f9d4220b3800f5b206c793b3350564afd26f68e024535960f537a6a767e106bfa46966b6c9705259636d39b43c006317a4b467252a518e946aff55b40ca10db5707671eb91f7a139b4032a56ff58259b640f1d32e0ab38271f2da200c47e867dac9a4128f3735be1c",
            "5b13a654f62a8fc0bac3fa077e52f607769f095de5132f997faeaf6a8e1d6323d4ec4ee7ae471615ce73d311c213193cea4e5c0fb6399a2c47574163dae66c82e1a49b88e319c672a68dadf19b233f8fe109edac18767adecc6244976bbd505e65817638d25a5faac399d659ce3504d5d05fca5177f5cbf316a13f20ba418715fea55a21a1914ff8b531b8b1502df2fec2b0c776052f4815c114b87eaf618b10defc753e5e869f0b1d9cffd8b7d46ca617553d80c5d35b51dc03647b87e00f9d5bd2e49c8ec621ac1873ee9c3138b023a63de6b921bab2711f467eb5377b226fb9eda33eb3d4d31f8be9b7252fb75ad86d2cdd412c3d47b21530ea42067286a8",
            "61ecf4a90b0fdc76fefc3fd813d1795efd0cb0604d271ad1deb719e424f0bebc95631cf11c7fde194224c844ccb0b46660a2cb738bab71325d969bc7ba81b3eea3752a8a5bd5b8b53e0aa3f8c90a5f056b45d81f8217738b072ab70576fd381a10ecd6d2debce06869793eae5a392617c93268912a64077cef28f2adc129dcecea55ca087d8eff214625c505b015a2a8928f34c296bd6a8ac01bc8c00aeda189e23f72cb518051a6519cd28e4bcf6e4ac012a107395f23cce1dee0e3b5b49db5e7bb793a740d11f2ba35717d54e6a87f72c2fb918b33c438bfffb6424ab70fa3b24e0cc44e6f71360ece3221791e2fe15cd8fb197def7cc9dcbfbddb70c6e997",
            "6e6aeda385521c9a24ae6b91929da497c6a66e98e8bb1bccb5bdf9fc7bb28f7bfb34d902d139613904bf04d3f2904598a5e6af5eeb5c816847a14a4130d15873dd7fa0dfb326124bdf2aa15ddfc1026220c11c9e8b2bd5fd6d1143da72a3b4ec39e0b7357df2d149610eea32f5094abff0d3e4f1a33e04d63b5ea487903d1056a3d07436089f25fe970027ace33ba1ad34298e375ee45eb4199e3de4fa5284f97b10ac0cc6766e49be5a9f266cf817931684748a84b45d1e27831f7b76decb19a7892d5f29a057c107583d2c3d3871ec6fad37955821535ebfb09eb24ac0fb32eb238dfeb6d215d9fce288d27a99833a7d4ccf0217f7d12d18fdf14b0882a6a3"
        );

        // act
        const isValid: boolean = proof.verify(cipher.c, cipher.d, publicKey, p, g);

        // assert
        expect(isValid).toStrictEqual(true);
    });

    it("should classify proof as invalid", () => {
        const publicKey: bigInt.BigInteger = BigNumberHelper.fromHexString("fc5aee5052734893d3c894154638d6cc72d38fe09f068785e9455a031a778147735407ffd5dd815ca8ce7d6e7451130dbcdcd52e1362688a59623373317aa2fa28cec5d57ee1450e27d110fb44684582e8ef849d06742eb10f5c93ea650b5800d52bf249f032682b452d5e78f21855e8dd115157f20f7f9b3453a80afd6ab0347644c01f71eb6bf1883c41414156194a49569205f5b24f37e05640d6b6949d51738c0d91621a97ac052b1dd5f16eaedaafb76820fe07ef1e7562c216ab0f923bc7630760e9149dae6ec90ea80272707e0052885d265d404f1dfe714cb956de07cface0807d606f409f672b0b738282489387eb886aaeeb99aa52075593f55236");

        const cipher: Cipher = {
            c: BigNumberHelper.fromHexString("a5b3ab609e17b34daca50edfff7ed2ecf1f8d67312f0cc7e12070c9ffabf1cb4c59d1d5c7e266b8e320dd4c16ade53821fb1f4ddeea27cb157a95cdb92fe074af3bcea094e6d978f37b39ffb23f70aab030d6c9fccfd2247d1877ae104c11a5a9c888176ad3fc340cd67eb9fd2341e567cec3699a9dd44881551c0c02c17f36864430cdd2abf20044a3de3f90b0f9921e0d54b457a6b7cac9635830d1a3ed6b4e4721b9080a88c0d941dddf2f63350569686b8f026ba4a3389e83ff774cf99d36022578dc7590b146a18227215728c6ce6e7b189e9f1e91a1356108c8a6fa622177680007a7da6fc2e03f6f7f349ce6ae5b78c5c2d2535bb0161eeb5e51f82e7"),
            d: BigNumberHelper.fromHexString("c9fdac59c83da0aaa09ee7e8751fdc794eaf12a87f96493b3d9e51dacf469f06a42aab0c8e47ae64b1e226b31bbadfb376dec28626703f22e1a2a8614cfec466ad6109050a2312d94029ada026e0764bf0824188423428539287855e7db6c91cccb23e7299b688ec79a894b7fe03f62d0a851e1e073ef040cbd53948d5d00c02b0a2e18c9fdabd70e6b35f0f96ac085149914e34c1e522812e99ac2c5730a80b1db2fb645d4a799ca06e2cbf76e908fbaa3e3a26e5eb89574518c003cf022951a53b6ab982cb3b698ee82c87a57268d3eb726aed35c2d9a9bc8c64c0627be0ac98f1f202d6fec777e98af4a73a92f60f71d93cab3b732f198582de6b10b36751")
        }

        const proof: ProofOfDecryption = new ProofOfDecryption(
            "dd26068235e6962e10f8f5d7ea71c19d1466b5284131be298fb907a9e6508921ba35c0bf0a11ceba4eff95efecc0c37efe2d9bcf3fb23fa74a7bdd28a7f59cd64781a3e5b8947388bf9c44b4c129d253a8bcdb73348fd6b438da21e7b5c3597adb6d03a295e3dd05a1edb7ee425a8fa09963e3a3005ec5058bd6abf06cb3273bb02c78ab1a38141f184f542809b9553968fc0f0423a4124f9d4220b3800f5b206c793b3350564afd26f68e024535960f537a6a767e106bfa46966b6c9705259636d39b43c006317a4b467252a518e946aff55b40ca10db5707671eb91f7a139b4032a56ff58259b640f1d32e0ab38271f2da200c47e867dac9a4128f3735be1c",
            "5b13a654f62a8fc0bac3fa077e52f607769f095de5132f997faeaf6a8e1d6323d4ec4ee7ae471615ce73d311c213193cea4e5c0fb6399a2c47574163dae66c82e1a49b88e319c672a68dadf19b233f8fe109edac18767adecc6244976bbd505e65817638d25a5faac399d659ce3504d5d05fca5177f5cbf316a13f20ba418715fea55a21a1914ff8b531b8b1502df2fec2b0c776052f4815c114b87eaf618b10defc753e5e869f0b1d9cffd8b7d46ca617553d80c5d35b51dc03647b87e00f9d5bd2e49c8ec621ac1873ee9c3138b023a63de6b921bab2711f467eb5377b226fb9eda33eb3d4d31f8be9b7252fb75ad86d2cdd412c3d47b21530ea42067286a8",
            "61ecf4a90b0fdc76fefc3fd813d1795efd0cb0604d271ad1deb719e424f0bebc95631cf11c7fde194224c844ccb0b46660a2cb738bab71325d969bc7ba81b3eea3752a8a5bd5b8b53e0aa3f8c90a5f056b45d81f8217738b072ab70576fd381a10ecd6d2debce06869793eae5a392617c93268912a64077cef28f2adc129dcecea55ca087d8eff214625c505b015a2a8928f34c296bd6a8ac01bc8c00aeda189e23f72cb518051a6519cd28e4bcf6e4ac012a107395f23cce1dee0e3b5b49db5e7bb793a740d11f2ba35717d54e6a87f72c2fb918b33c438bfffb6424ab70fa3b24e0cc44e6f71360ece3221791e2fe15cd8fb197def7cc9dcbfbddb70c6e997",
            "6e6aeda385521c9a24ae6b91929da497c6a66e98e8bb1bccb5bdf9fc7bb28f7bfb34d902d139613904bf04d3f2904598a5e6af5eeb5c816847a14a4130d15873dd7fa0dfb326124bdf2aa15ddfc1026220c11c9e8b2bd5fd6d1143da72a3b4ec39e0b7357df2d149610eea32f5094abff0d3e4f1a33e04d63b5ea487903d1056a3d07436089f25fe970027ace33ba1ad34298e375ee45eb4199e3de4fa5284f97b10ac0cc6766e49be5a9f266cf817931684748a84b45d1e27831f7b76decb19a7892d5f29a057c107583d2c3d3871ec6fad37955821535ebfb09eb24ac0fb32eb238dfeb6d215d9fce288d27a99833a7d4ccf0217f7d12d18fdf14b0882a6a3"
        );

        // act
        const isValid: boolean = proof.verify(cipher.c, cipher.d, publicKey, p, g);

        // assert
        expect(isValid).toStrictEqual(false);
    });
})